const w="GraphQL Client";const x="An error occurred while fetching from the API. Review 'graphQLErrors' for details.",U="Response returned unexpected Content-Type:",v="An unknown error has occurred. The API did not return a data object or any errors in its response.",$={json:"application/json",multipart:"multipart/mixed"},D="X-SDK-Variant",C="X-SDK-Version",Q="shopify-graphql-client",X="1.4.1",L=1e3,G=[429,503],P=/@(defer)\b/i,N=`\r
`,B=/boundary="?([^=";]+)"?/i,b=N+N;function E(e,t=w){return e.startsWith(`${t}`)?e:`${t}: ${e}`}function y(e){return e instanceof Error?e.message:JSON.stringify(e)}function V(e){return e instanceof Error&&e.cause?e.cause:void 0}function k(e){return e.flatMap(({errors:t})=>t??[])}function H({client:e,retries:t}){if(t!==void 0&&(typeof t!="number"||t<0||t>3))throw new Error(`${e}: The provided "retries" value (${t}) is invalid - it cannot be less than 0 or greater than 3`)}function l(e,t){return t&&(typeof t!="object"||Array.isArray(t)||typeof t=="object"&&Object.keys(t).length>0)?{[e]:t}:{}}function j(e,t){if(e.length===0)return t;const n={[e.pop()]:t};return e.length===0?n:j(e,n)}function F(e,t){return Object.keys(t||{}).reduce((r,n)=>(typeof t[n]=="object"||Array.isArray(t[n]))&&e[n]?(r[n]=F(e[n],t[n]),r):(r[n]=t[n],r),Array.isArray(e)?[...e]:{...e})}function q([e,...t]){return t.reduce(F,{...e})}function Y({clientLogger:e,customFetchApi:t=fetch,client:r=w,defaultRetryWaitTime:n=L,retriableCodes:o=G}){const a=async(i,s,c)=>{const u=s+1,f=c+1;let d;try{if(d=await t(...i),e({type:"HTTP-Response",content:{requestParams:i,response:d}}),!d.ok&&o.includes(d.status)&&u<=f)throw new Error;const p=d?.headers.get("X-Shopify-API-Deprecated-Reason")||"";return p&&e({type:"HTTP-Response-GraphQL-Deprecation-Notice",content:{requestParams:i,deprecationNotice:p}}),d}catch(p){if(u<=f){const h=d?.headers.get("Retry-After");return await J(h?parseInt(h,10):n),e({type:"HTTP-Retry",content:{requestParams:i,lastResponse:d,retryAttempt:s,maxRetries:c}}),a(i,u,c)}throw new Error(E(`${c>0?`Attempted maximum number of ${c} network retries. Last message - `:""}${y(p)}`,r))}};return a}async function J(e){return new Promise(t=>setTimeout(t,e))}function W({headers:e,url:t,customFetchApi:r=fetch,retries:n=0,logger:o}){H({client:w,retries:n});const a={headers:e,url:t,retries:n},i=z(o),s=Y({customFetchApi:r,clientLogger:i,defaultRetryWaitTime:L}),c=Z(s,a),u=ee(c),f=ie(c);return{config:a,fetch:c,request:u,requestStream:f}}function z(e){return t=>{e&&e(t)}}async function K(e){const{errors:t,data:r,extensions:n}=await e.json();return{...l("data",r),...l("extensions",n),headers:e.headers,...t||!r?{errors:{networkStatusCode:e.status,message:E(t?x:v),...l("graphQLErrors",t),response:e}}:{}}}function Z(e,{url:t,headers:r,retries:n}){return async(o,a={})=>{const{variables:i,headers:s,url:c,retries:u,keepalive:f,signal:d}=a,p=JSON.stringify({query:o,variables:i});H({client:w,retries:u});const h=Object.entries({...r,...s}).reduce((R,[A,g])=>(R[A]=Array.isArray(g)?g.join(", "):g.toString(),R),{});return!h[D]&&!h[C]&&(h[D]=Q,h[C]=X),e([c??t,{method:"POST",headers:h,body:p,signal:d,keepalive:f}],1,u??n)}}function ee(e){return async(...t)=>{if(P.test(t[0]))throw new Error(E("This operation will result in a streamable response - use requestStream() instead."));let r=null;try{r=await e(...t);const{status:n,statusText:o}=r,a=r.headers.get("content-type")||"";return r.ok?a.includes($.json)?await K(r):{errors:{networkStatusCode:n,message:E(`${U} ${a}`),response:r}}:{errors:{networkStatusCode:n,message:E(o),response:r}}}catch(n){return{errors:{message:y(n),...r==null?{}:{networkStatusCode:r.status,response:r}}}}}}async function*te(e){const t=new TextDecoder;if(e.body[Symbol.asyncIterator])for await(const r of e.body)yield t.decode(r);else{const r=e.body.getReader();let n;try{for(;!(n=await r.read()).done;)yield t.decode(n.value)}finally{r.cancel()}}}function re(e,t){return{async*[Symbol.asyncIterator](){try{let r="";for await(const n of e)if(r+=n,r.indexOf(t)>-1){const o=r.lastIndexOf(t),i=r.slice(0,o).split(t).filter(s=>s.trim().length>0).map(s=>s.slice(s.indexOf(b)+b.length).trim());i.length>0&&(yield i),r=r.slice(o+t.length),r.trim()==="--"&&(r="")}}catch(r){throw new Error(`Error occured while processing stream payload - ${y(r)}`)}}}}function ne(e){return{async*[Symbol.asyncIterator](){yield{...await K(e),hasNext:!1}}}}function oe(e){return e.map(t=>{try{return JSON.parse(t)}catch(r){throw new Error(`Error in parsing multipart response - ${y(r)}`)}}).map(t=>{const{data:r,incremental:n,hasNext:o,extensions:a,errors:i}=t;if(!n)return{data:r||{},...l("errors",i),...l("extensions",a),hasNext:o};const s=n.map(({data:c,path:u,errors:f})=>({data:c&&u?j(u,c):{},...l("errors",f)}));return{data:s.length===1?s[0].data:q([...s.map(({data:c})=>c)]),...l("errors",k(s)),hasNext:o}})}function se(e,t){if(e.length>0)throw new Error(x,{cause:{graphQLErrors:e}});if(Object.keys(t).length===0)throw new Error(v)}function ae(e,t){const r=(t??"").match(B),n=`--${r?r[1]:"-"}`;if(!e.body?.getReader&&!e.body?.[Symbol.asyncIterator])throw new Error("API multipart response did not return an iterable body",{cause:e});const o=te(e);let a={},i;return{async*[Symbol.asyncIterator](){try{let s=!0;for await(const c of re(o,n)){const u=oe(c);i=u.find(d=>d.extensions)?.extensions??i;const f=k(u);a=q([a,...u.map(({data:d})=>d)]),s=u.slice(-1)[0].hasNext,se(f,a),yield{...l("data",a),...l("extensions",i),hasNext:s}}if(s)throw new Error("Response stream terminated unexpectedly")}catch(s){const c=V(s);yield{...l("data",a),...l("extensions",i),errors:{message:E(y(s)),networkStatusCode:e.status,...l("graphQLErrors",c?.graphQLErrors),response:e},hasNext:!1}}}}}function ie(e){return async(...t)=>{if(!P.test(t[0]))throw new Error(E("This operation does not result in a streamable response - use request() instead."));try{const r=await e(...t),{statusText:n}=r;if(!r.ok)throw new Error(n,{cause:r});const o=r.headers.get("content-type")||"";switch(!0){case o.includes($.json):return ne(r);case o.includes($.multipart):return ae(r,o);default:throw new Error(`${U} ${o}`,{cause:r})}}catch(r){return{async*[Symbol.asyncIterator](){const n=V(r);yield{errors:{message:E(y(r)),...l("networkStatusCode",n?.status),...l("response",n)},hasNext:!1}}}}}}function ce({client:e,storeDomain:t}){try{const r=t.trim(),n=r.match(/^https?:/)?r:`https://${r}`,o=new URL(n);return o.protocol="https",o.origin}catch(r){throw new Error(`${e}: a valid store domain ("${t}") must be provided`,{cause:r})}}function M({client:e,currentSupportedApiVersions:t,apiVersion:r,logger:n}){const o=`${e}: the provided apiVersion ("${r}")`,a=`Currently supported API versions: ${t.join(", ")}`;if(!r||typeof r!="string")throw new Error(`${o} is invalid. ${a}`);const i=r.trim();t.includes(i)||(n?n({type:"Unsupported_Api_Version",content:{apiVersion:r,supportedApiVersions:t}}):console.warn(`${o} is likely deprecated or not supported. ${a}`))}function T(e){const t=e*3-2;return t===10?t:`0${t}`}function I(e,t,r){const n=t-r;return n<=0?`${e-1}-${T(n+4)}`:`${e}-${T(n)}`}function ue(){const e=new Date,t=e.getUTCMonth(),r=e.getUTCFullYear(),n=Math.floor(t/3+1);return{year:r,quarter:n,version:`${r}-${T(n)}`}}function de(){const{year:e,quarter:t,version:r}=ue(),n=t===4?`${e+1}-01`:`${e}-${T(t+1)}`;return[I(e,t,3),I(e,t,2),I(e,t,1),r,n,"unstable"]}function le(e){return t=>({...t??{},...e.headers})}function fe({getHeaders:e,getApiUrl:t}){return(r,n)=>{const o=[r];if(n&&Object.keys(n).length>0){const{variables:a,apiVersion:i,headers:s,retries:c,signal:u}=n;o.push({...a?{variables:a}:{},...s?{headers:e(s)}:{},...i?{url:t(i)}:{},...c?{retries:c}:{},...u?{signal:u}:{}})}return o}}const O="application/json",pe="storefront-api-client",he="1.0.9",Ee="X-Shopify-Storefront-Access-Token",ye="X-SDK-Variant",Re="X-SDK-Version",Ae="X-SDK-Variant-Source",S="Storefront API Client";function me(e){if(e&&typeof window<"u")throw new Error(`${S}: private access tokens and headers should only be used in a server-to-server implementation. Use the public API access token in nonserver environments.`)}function ge(e,t){if(t)throw new Error(`${S}: only provide either a public or private access token`)}function Te({storeDomain:e,apiVersion:t,publicAccessToken:r,privateAccessToken:n,clientName:o,retries:a=0,customFetchApi:i,logger:s}){const c=de(),u=ce({client:S,storeDomain:e}),f={client:S,currentSupportedApiVersions:c,logger:s};M({...f,apiVersion:t}),ge(r,n),me(n);const d=Se(u,t,f),p={storeDomain:u,apiVersion:t,publicAccessToken:r,headers:{"Content-Type":O,Accept:O,[ye]:pe,[Re]:he,...o?{[Ae]:o}:{},[Ee]:r},apiUrl:d(),clientName:o},h=W({headers:p.headers,url:p.apiUrl,retries:a,customFetchApi:i,logger:s}),_=le(p),R=we(p,d),A=fe({getHeaders:_,getApiUrl:R});return Object.freeze({config:p,getHeaders:_,getApiUrl:R,fetch:(...m)=>h.fetch(...A(...m)),request:(...m)=>h.request(...A(...m)),requestStream:(...m)=>h.requestStream(...A(...m))})}function Se(e,t,r){return n=>{n&&M({...r,apiVersion:n});const o=(n??t).trim();return`${e}/api/${o}/graphql.json`}}function we(e,t){return r=>r?t(r):e.apiUrl}const _e=Te({storeDomain:"dtallesjewelry.com",apiVersion:"2025-10",publicAccessToken:"851965f8a7e17cf35de22fdcbe44c100"}),Ie=(e,...t)=>e.reduce((r,n,o)=>`${r}${n}${o in t?String(t[o]):""}`,"");export{_e as c,Ie as g};
